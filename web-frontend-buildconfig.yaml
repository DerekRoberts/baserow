apiVersion: v1
kind: BuildConfig
metadata:
  labels:
    app: baserow
    component: baserow-web-frontend
  name: baserow-web-frontend
spec:
  output:
    to:
      kind: ImageStreamTag
      name: baserow-web-frontend:latest
  resources:
    limits:
      memory: 4Gi
    requests:
      memory: 2Gi
  selector:
    app: baserow-web-frontend
    deploymentconfig: baserow-web-frontend
  source:
    dockerfile: |
      FROM node:10

      WORKDIR /web-frontend
      RUN git clone https://gitlab.com/bramw/baserow.git /tmp/baserow && \
          cp -rT /tmp/baserow/web-frontend . && \
          rm -rf /tmp/baserow

      RUN npm install
      RUN npm run build

      RUN mkdir /.npm && \
          chown -R 1000870000:0 /.npm && \
          chmod -R 777 /web-frontend

      CMD npm run start

    type: Dockerfile
  strategy:
    dockerStrategy:
      from:
        kind: DockerImage
        name: node:10
    type: Docker
  triggers:
    - type: ConfigChange
    - imageChange: {}
      type: ImageChange
